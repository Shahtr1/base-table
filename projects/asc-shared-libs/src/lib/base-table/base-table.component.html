<div class="card">
  <p-table
    #table
    [columns]="tableColumns"
    [dataKey]="dataKey"
    [value]="items"
    [styleClass]="selectedSize.class + ' p-datatable-gridlines'"
    responsiveLayout="stack"
    [breakpoint]="responsiveLayoutBreakpoint + 'px'"
    [paginator]="paginator"
    [rows]="rowsPerPage"
    [totalRecords]="totalRows"
    [showCurrentPageReport]="true"
    [currentPageReportTemplate]="getReportTemplateString()"
    [rowsPerPageOptions]="rowsPerPageOptions"
    (sortFunction)="getCustomSortFn($event)"
    [customSort]="customSort"
    [globalFilterFields]="globalFilterFields"
    [selectionMode]="selectionMode"
    [(selection)]="selectedItems"
    [rowSelectable]="isRowSelectable"
    (onRowSelect)="onRowSelect($event)"
    (onRowUnselect)="onRowUnselect($event)"
    [selectionPageOnly]="selectionPageOnly"
    [rowHover]="rowHover"
    [scrollHeight]="
      scrollHeight === 'auto' ? scrollHeight : scrollHeight + 'px'
    "
    [scrollable]="scrollHeight !== 'auto'"
    [resizableColumns]="true"
    columnResizeMode="expand"
  >
    <ng-container *ngIf="showCaption">
      <ng-template pTemplate="caption">
        <ng-container>
          <div #caption>
            <ng-content select="caption"></ng-content>
          </div>
        </ng-container>
        <ng-container *ngIf="caption.childNodes.length == 0">
          <div
            class="caption-default-wrapper"
            [ngStyle]="{
              padding: rowExpand && !selectionMode ? '0 2rem' : 'unset'
            }"
          >
            <span *ngIf="title">{{ title }}</span>
            <span class="p-input-icon-left">
              <i class="pi pi-search"></i>
              <input
                pInputText
                type="text"
                (input)="
                  table.filterGlobal(getElement($event).value, 'contains')
                "
                [placeholder]="generalTexts.globalSearch.label"
              />
            </span>
            <lib-toolbar-buttons
              [showAddButton]="showAddButton"
              [items]="items"
              [exportColumns]="exportColumns"
              [table]="table"
              [exportTypes]="exportTypes"
              [selectedItems]="selectedItems"
              [exportFileName]="exportFileName"
            ></lib-toolbar-buttons>
          </div>
        </ng-container>
      </ng-template>
    </ng-container>
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 4rem" *ngIf="selectionMode !== undefined">
          <p-tableHeaderCheckbox
            *ngIf="selectionMode === 'multiple'"
            (click)="selectAll($event)"
            [disabled]="!isRowSelectable()"
          ></p-tableHeaderCheckbox>
        </th>
        <th style="width: 5rem" *ngIf="rowExpand"></th>
        <th
          *ngFor="let col of tableColumns"
          [pSortableColumn]="col.sort ? col.field : undefined"
          [width]="columnWidth + '%'"
        >
          {{ col.header }}
          <p-sortIcon [field]="col.field" *ngIf="col.sort"></p-sortIcon>
        </th>
      </tr>
      <tr>
        <th *ngIf="selectionMode !== undefined"></th>
        <th *ngIf="rowExpand"></th>
        <th *ngFor="let col of tableColumns">
          <!--  text column filter-->
          <p-columnFilter
            type="text"
            [field]="col.field"
            *ngIf="col.filter === 'text'"
            matchMode="contains"
            [placeholder]="generalTexts.search.label"
          ></p-columnFilter>

          <!--  select column filter-->
          <p-columnFilter
            *ngIf="col.filter === 'select'"
            [field]="col.field"
            matchMode="equals"
            [showMenu]="false"
          >
            <ng-template
              pTemplate="filter"
              let-value
              let-filter="filterCallback"
            >
              <p-dropdown
                [ngModel]="value"
                [options]="getDropdownOptions(col.field)"
                (onChange)="filter($event.value)"
                [placeholder]="generalTexts.select.label"
                [showClear]="true"
                appendTo="body"
              >
              </p-dropdown>
            </ng-template>
          </p-columnFilter>

          <!--  multiselect column filter-->
          <p-columnFilter
            *ngIf="col.filter === 'multiselect'"
            [field]="col.field"
            matchMode="in"
            [showMenu]="false"
            id="multiselect-column-filter"
          >
            <ng-template
              pTemplate="filter"
              let-value
              let-filter="filterCallback"
            >
              <p-multiSelect
                [ngModel]="value"
                [options]="getDropdownOptions(col.field)"
                [placeholder]="generalTexts.multiselect.label"
                (onChange)="filter($event.value)"
                appendTo="body"
                selectedItemsLabel="ellipsis"
              >
              </p-multiSelect>
            </ng-template>
          </p-columnFilter>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item let-expanded="expanded">
      <tr>
        <td *ngIf="selectionMode !== undefined">
          <p-tableCheckbox
            [value]="item"
            *ngIf="selectionMode === 'multiple'"
            [disabled]="!isRowSelectable()"
          ></p-tableCheckbox>
          <p-tableRadioButton
            [value]="item"
            *ngIf="selectionMode === 'single'"
            [disabled]="!isRowSelectable()"
          ></p-tableRadioButton>
        </td>
        <td *ngIf="rowExpand">
          <button
            type="button"
            pButton
            pRipple
            [pRowToggler]="item"
            class="p-button-text p-button-rounded p-button-plain"
            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
          ></button>
        </td>
        <td *ngFor="let col of tableColumns">
          {{ item[col.field] }}
        </td>
      </tr>
    </ng-template>
    <ng-container *ngIf="showSummary">
      <ng-template pTemplate="summary">
        <ng-content select="summary"></ng-content>
      </ng-template>
    </ng-container>
    <ng-template pTemplate="rowexpansion" let-item>
      <ng-container
        *ngTemplateOutlet="rowExpansionTemplate; context: { $implicit: item }"
      >
      </ng-container>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6" style="text-align: center">{{ emptyMessage }}</td>
      </tr>
    </ng-template>
  </p-table>
</div>
